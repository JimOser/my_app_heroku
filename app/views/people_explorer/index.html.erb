<main class="pe-page <%= Rails.env.development? ? 'pe-dev' : 'pe-prod' %>">
  <header class="pe-header">
    <h1>People Explorer</h1>

    <div class="pe-controls">
      <label for="jump-person">Jump to person</label>
      <select id="jump-person">
        <option value="">— Select —</option>
        <% @people.each do |p| %>
          <option value="person-<%= p.id %>"><%= p.name %></option>
        <% end %>
      </select>
    </div>

    <p class="pe-note">
      <%= Rails.env.development? ? "Development: inline editing is ON." : "Production: read-only." %>
    </p>
  </header>

  <section class="pe-grid">
    <% @people.each do |person| %>
      <article id="person-<%= person.id %>" class="pe-card pe-person">
        <header class="pe-card-header">
          <h2><%= person.name %></h2>
          <% if person.bio.present? %>
            <p class="pe-subtle"><%= person.bio %></p>
          <% end %>
        </header>
        <%# NOTE: Books/Podcasts/Songs sections are intentionally omitted in PE-1 %>
        <%# ----- Books authored ----- %>
<details class="pe-section" open>
  <summary>Books (<%= person.authored_books.size %>)</summary>
  <div class="pe-list">
    <% person.authored_books.each do |book| %>
      <div class="pe-item pe-book">
        <%= render "people_explorer/edit_or_show",
                   record: book,
                   fields: {
                     title: :string,
                     url: :url,
                     published_on: :date,
                     status: :string,
                     author_ids: :people_multi
                   } %>
        <p class="pe-subtle">Authors:
          <%= book.authors.any? ? book.authors.map(&:name).join(", ") : "—" %>
        </p>
      </div>
    <% end %>
  </div>
</details>
<%# ----- Podcasts (legacy: person.podcasts) ----- %>
<details class="pe-section">
  <summary>Podcasts (<%= person.podcasts.size %>)</summary>
  <div class="pe-list">
    <% person.podcasts.each do |podcast| %>
      <div class="pe-item pe-podcast">
        <%= render "people_explorer/edit_or_show",
                   record: podcast,
                   fields: { title: :string, description: :text } %>

        <%# Episodes for this podcast %>
        <details class="pe-subsection">
          <summary>Episodes (<%= podcast.episodes.size %>)</summary>
          <div class="pe-sublist">
            <% podcast.episodes.each do |ep| %>
              <div class="pe-subitem pe-episode">
                <%= render "people_explorer/edit_or_show",
                           record: ep,
                           fields: { number: :string, title: :string, url: :url, youtube_url: :url, released_on: :date } %>
              </div>
            <% end %>
          </div>
        </details>
      </div>
    <% end %>
  </div>
</details>
<%# ----- Songs (legacy: person.songs) ----- %>
<details class="pe-section">
  <summary>Songs (<%= person.songs.size %>)</summary>
  <div class="pe-list">
    <% person.songs.each do |song| %>
      <div class="pe-item pe-song">
        <%= render "people_explorer/edit_or_show",
                   record: song,
                   fields: { title: :string, released_on: :date, youtube_url: :url, spotify_url: :url } %>
        <p class="pe-subtle">
          Singer:
          <% if song.respond_to?(:singer) && song.singer %>
            <%= link_to song.singer.name, person_path(song.singer) %>
          <% else %>
            —
          <% end %>
        </p>
      </div>
    <% end %>
  </div>
</details>

      </article>
    <% end %>
  </section>
</main>

<script>
document.addEventListener("change", function (e) {
  if (e.target && e.target.id === "jump-person" && e.target.value) {
    location.hash = e.target.value;
  }
});
</script>

