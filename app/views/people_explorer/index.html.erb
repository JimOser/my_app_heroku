<main class="pe-page <%= Rails.env.development? ? 'pe-dev' : 'pe-prod' %>">
  <header class="pe-header">
    <h1>People Explorer</h1>

    <div class="pe-controls">
      <label for="jump-person">Jump to person</label>
      <select id="jump-person">
        <option value="">— Select —</option>
        <% @people.each do |p| %>
          <option value="person-<%= p.id %>"><%= p.name %></option>
        <% end %>
      </select>
    </div>

    <p class="pe-note">
      <%= Rails.env.development? ? "Development: inline editing is OFF in this template (read-only preview)." : "Production: read-only." %>
    </p>
  </header>

  <section class="pe-grid">
    <% @people.each do |person| %>
      <article id="person-<%= person.id %>" class="pe-card pe-person">
        <header class="pe-card-header">
          <h2><%= person.name %></h2>
          <% if person.bio.present? %>
            <p class="pe-subtle"><%= person.bio %></p>
          <% end %>
        </header>

        <!-- Books -->
        <details class="pe-section" open>
          <summary>Books (<%= person.authored_books.size %>)</summary>
          <div class="pe-list">
            <% person.authored_books.each do |book| %>
              <div class="pe-item pe-book">
                <strong><%= link_to book.title, book_path(book) %></strong>
                <% if book.authors.any? %>
                  <div class="pe-subtle">Authors: <%= book.authors.map(&:name).join(", ") %></div>
                <% end %>
              </div>
            <% end %>
          </div>
        </details>

        <!-- Podcasts -->
        <details class="pe-section">
          <summary>Podcasts (<%= person.hosted_podcasts.size %>)</summary>
          <div class="pe-list">
            <% person.hosted_podcasts.each do |podcast| %>
              <div class="pe-item pe-podcast">
                <strong><%= link_to podcast.title, podcast_path(podcast) %></strong>
                <% if podcast.episodes.any? %>
                  <div class="pe-subtle">Episodes: <%= podcast.episodes.count %></div>
                <% end %>
              </div>
            <% end %>
          </div>
        </details>

        <!-- Songs -->
        <details class="pe-section">
          <summary>Songs (<%= person.sung_songs.size %>)</summary>
          <div class="pe-list">
            <% person.sung_songs.each do |song| %>
              <div class="pe-item pe-song">
                <strong><%= link_to song.title, song_path(song) %></strong>
                <% if song.singers.any? %>
                  <div class="pe-subtle">Singers: <%= song.singers.map(&:name).join(", ") %></div>
                <% end %>
              </div>
            <% end %>
          </div>
        </details>

      </article>
    <% end %>
  </section>
</main>

<script>
document.addEventListener("change", function (e) {
  if (e.target && e.target.id === "jump-person" && e.target.value) {
    location.hash = e.target.value;
  }
});
</script>
